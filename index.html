<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flashcards App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fc;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    h1 { color: #333; margin-bottom: 20px; }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 40px;
      width: 420px;
      min-height: 200px;
      text-align: center;
      box-shadow: 0 6px 14px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: transform 0.3s ease;
    }
    .card:hover { transform: translateY(-5px); }
    #question {
      font-size: 20px;
      font-weight: bold;
      color: #222;
    }
    #answer {
      margin-top: 20px;
      font-size: 18px;
      color: #555;
      display: none;
    }
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
    }
    button {
      padding: 10px 20px;
      
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      background: #007bff;
      color: #fff;
      transition: background 0.3s ease;
    }
    button:hover { background: #0056b3; }
    button:disabled { background: #aaa; cursor: not-allowed; }
    select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>Excel Flashcards</h1>
  <input type="file" id="upload" accept=".xlsx,.xls" />
  <div class="controls">
    <label for="topicSelect">Topic:</label>
    <select id="topicSelect" disabled></select>
  </div>
  <div class="card" id="flashcard">
    <div id="question">Upload an Excel file to start</div>
    <div id="answer"></div>
    <centre>
    <div class="controls">
      <button id="toggleBtn" disabled>Start</button>
    </div>
    </centre>
  </div>

  <script>
    let flashcardsBySheet = {};
    let flashcards = [];
    let currentIndex = -1;
    let showingAnswer = false;

    const upload = document.getElementById('upload');
    const topicSelect = document.getElementById('topicSelect');
    const toggleBtn = document.getElementById('toggleBtn');
    const qDiv = document.getElementById('question');
    const aDiv = document.getElementById('answer');

    upload.addEventListener('change', handleFile, false);
    topicSelect.addEventListener('change', handleTopicChange);
    toggleBtn.addEventListener('click', handleToggle);

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: 'array' });

        flashcardsBySheet = {};
        workbook.SheetNames.forEach(sheetName => {
          const sheet = workbook.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          const cards = rows.slice(1)
            .filter(r => r.length >= 2)
            .map(r => ({ question: r[0], answer: r[1] }));
          if (cards.length > 0) {
            flashcardsBySheet[sheetName] = cards;
          }
        });

        // Populate dropdown
        topicSelect.innerHTML = "";
        const allOption = document.createElement('option');
        allOption.value = "ALL";
        allOption.textContent = "All Topics";
        topicSelect.appendChild(allOption);

        Object.keys(flashcardsBySheet).forEach(sheet => {
          const opt = document.createElement('option');
          opt.value = sheet;
          opt.textContent = sheet;
          topicSelect.appendChild(opt);
        });

        topicSelect.disabled = false;
        topicSelect.value = "ALL";
        handleTopicChange();
      };
      reader.readAsArrayBuffer(file);
    }

    function handleTopicChange() {
      const selected = topicSelect.value;
      if (selected === "ALL") {
        flashcards = Object.values(flashcardsBySheet).flat();
      } else {
        flashcards = flashcardsBySheet[selected] || [];
      }

      if (flashcards.length > 0) {
        toggleBtn.disabled = false;
        nextQuestion();
      } else {
        toggleBtn.disabled = true;
        qDiv.textContent = "No questions found in this topic.";
        aDiv.style.display = "none";
      }
    }

    function handleToggle() {
      if (!showingAnswer) {
        showAnswer();
      } else {
        nextQuestion();
      }
    }

    function nextQuestion() {
      currentIndex = Math.floor(Math.random() * flashcards.length);
      qDiv.textContent = flashcards[currentIndex].question;
      aDiv.style.display = "none";
      showingAnswer = false;
      toggleBtn.textContent = "Show Answer";
    }

    function showAnswer() {
      if (currentIndex >= 0) {
        aDiv.textContent = flashcards[currentIndex].answer;
        aDiv.style.display = "block";
        showingAnswer = true;
        toggleBtn.textContent = "Next Question";
      }
    }
  </script>
</body>
</html>
